<!--
Google IO 2012/2013 HTML5 Slide Template

Authors: Eric Bidelman <ebidel@gmail.com>
         Luke Mah√© <lukem@google.com>

URL: https://code.google.com/p/io-2012-slides
--><!DOCTYPE html>


<html>
<head>
  <title>25. Coverity Scan &mdash; Devguide</title>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <!--<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">-->
  <!--<meta name="viewport" content="width=device-width, initial-scale=1.0">-->
  <!--This one seems to work all the time, but really small on ipad-->
  <!--<meta name="viewport" content="initial-scale=0.4">-->
  <meta name="apple-mobile-web-app-capable" content="yes">

  <meta name="hieroglyph-title" data-config-title>
  <meta name="hieroglyph-subtitle" data-config-subtitle>
  <meta name="hieroglyph-presenter" data-config-presenter>

  
  <link rel="stylesheet" media="all"
        href="_static/theme/css/default.css">
  <link rel="stylesheet" media="all"
        href="_static/theme/css/hieroglyph.css">
  <link rel="stylesheet" media="only screen and (max-device-width: 480px)"
        href="_static/theme/css/phone.css">

    

    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <base target="_blank"> <!-- This amazingness opens all links in a new tab. -->
  
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2015.08.08',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>

    <script data-main="_static/js/slides"
            src="_static/js/require-1.0.8.min.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    
    <link rel="top" title="Devguide" href="index.html" />
    <link rel="next" title="26. Dynamic Analysis with Clang" href="clang.html" />
    <link rel="prev" title="24. Design of CPython&#39;s Compiler" href="compiler.html" /> 
</head>
<body style="opacity: 0">

<slides class="layout-widescreen">

  

  
    <slide class="title-slide segue nobackground level-1" id="coverity-scan">
    <hgroup>
      <h1>Coverity Scan</h1>
    </hgroup>
    <article class="">
      <p id="coverity">Coverity Scan is a free service for static code analysis of Open Source
projects. It is based on Coverity's commercial product and is able to analyze
C, C++ and Java code.</p>
<p>Coverity's static code analysis doesn't run the code. Instead of that it uses
abstract interpretation to gain information about the code's control flow and
data flow. It's able to follow all possible code paths that a program may
take. For example the analyzer understands that <code class="docutils literal"><span class="pre">malloc()</span></code> returns a memory
that must be freed with <code class="docutils literal"><span class="pre">free()</span></code> later. It follows all branches and function
calls to see if all possible combinations free the memory. The analyzer is
able to detect all sorts of issues like resource leaks (memory, file
descriptors), NULL dereferencing, use after free, unchecked return values,
dead code, buffer overflows, integer overflows, uninitialized variables, and
many more.</p>




    </article>
  </slide>  <slide class="level-2" id="access-to-analysis-reports">
    <hgroup>
      <h2>Access to analysis reports</h2>
    </hgroup>
    <article class="">
      <p>The results are available on the <a class="reference external" href="http://scan.coverity.com/">Coverity Scan</a> website. In order to
access the results you have to create an account yourself. Then go to
<em>Projects using Scan</em> and add yourself to the Python project. New members must
be approved by an admin (see <a class="reference internal" href="#contact">Contact</a>).</p>
<p>Access is restricted to Python core developers only. Other individuals may be
given access at our own discretion, too. Every now and then Coverity detects a
critical issue in Python's code -- new analyzers may even find new bugs in
mature code. We don't want to disclose issues prematurely.</p>




    </article>
  </slide>  <slide class="level-2" id="building-and-uploading-analysis">
    <hgroup>
      <h2>Building and uploading analysis</h2>
    </hgroup>
    <article class="">
      <p>The process is automated. A script runs <code class="docutils literal"><span class="pre">hg</span> <span class="pre">pull</span></code>, <code class="docutils literal"><span class="pre">hg</span> <span class="pre">update</span></code>,
<code class="docutils literal"><span class="pre">cov-build</span></code> and uploads the latest analysis to Coverity. Since Coverity has
limited the maximum number of builds per week Python is analyzed every second
day. The build runs on a dedicated virtual machine on PSF's infrastructure at
OSU Open Source Labs. The process is maintained by Christian Heimes (see
<a class="reference internal" href="#contact">Contact</a>). At present only the tip is analyzed with the 64bit Linux tools.</p>




    </article>
  </slide>  <slide class="level-2" id="known-limitations">
    <hgroup>
      <h2>Known limitations</h2>
    </hgroup>
    <article class="">
      <p>Some aspects of Python's C code are not yet understood by Coverity.</p>




    </article>
  </slide>  <slide class="level-3" id="false-positives">
    <hgroup>
      <h3>False positives</h3>
    </hgroup>
    <article class="">
      <dl class="docutils">
<dt><code class="docutils literal"><span class="pre">Py_BuildValue(&quot;N&quot;,</span> <span class="pre">PyObject*)</span></code></dt>
<dd>Coverity doesn't understand that <code class="docutils literal"><span class="pre">N</span></code> format char passes the object along
without touching its reference count. On this ground the analyzer detects
a resource leak. CID 719685</dd>
<dt><code class="docutils literal"><span class="pre">PyLong_FromLong()</span></code> for negative values</dt>
<dd>Coverity claims that <code class="docutils literal"><span class="pre">PyLong_FromLong()</span></code> and other <code class="docutils literal"><span class="pre">PyLong_From*()</span></code>
functions cannot handle a negative value because the value might be used as
an array index in <code class="docutils literal"><span class="pre">get_small_int()</span></code>. CID 486783</dd>
<dt><code class="docutils literal"><span class="pre">PyLong_FromLong()</span></code> for n in [-5 ... +255]</dt>
<dd>For integers in the range of Python's small int cache the <code class="docutils literal"><span class="pre">PyLong_From*()</span></code>
function can never fail and never returns NULL. CID 1058291</dd>
<dt><code class="docutils literal"><span class="pre">PyArg_ParseTupleAndKeywords(args,</span> <span class="pre">kwargs,</span> <span class="pre">&quot;s#&quot;,</span> <span class="pre">&amp;data,</span> <span class="pre">&amp;length)</span></code></dt>
<dd>Some functions use the format char combination such as <code class="docutils literal"><span class="pre">s#</span></code>, <code class="docutils literal"><span class="pre">u#</span></code> or
<code class="docutils literal"><span class="pre">z#</span></code> to get data and length of a character array. Coverity doesn't
recognize the relation between data and length. Sometimes it detects a buffer
overflow if data is written to a fixed size buffer although
<code class="docutils literal"><span class="pre">length</span> <span class="pre">&lt;=</span> <span class="pre">sizeof(buffer)</span></code>.  CID 486613</dd>
<dt><code class="docutils literal"><span class="pre">path_converter()</span></code> dereferencing after null check</dt>
<dd>The <code class="docutils literal"><span class="pre">path_converter()</span></code> function in <code class="docutils literal"><span class="pre">posixmodule.c</span></code> makes sure that
either <code class="docutils literal"><span class="pre">path_t.narrow</span></code> or <code class="docutils literal"><span class="pre">path_t.wide</span></code> is filled unless
<code class="docutils literal"><span class="pre">path_t.nullable</span></code> is explicitly enabled. CID 719648</dd>
</dl>




    </article>
  </slide>  <slide class="level-3" id="intentionally">
    <hgroup>
      <h3>Intentionally</h3>
    </hgroup>
    <article class="">
      <dl class="docutils">
<dt><code class="docutils literal"><span class="pre">Py_VA_COPY()</span></code></dt>
<dd>Python is written in C89 (ANSI C), therefore it can't use C99 features such
as <code class="docutils literal"><span class="pre">va_copy()</span></code>. Python's own variant <code class="docutils literal"><span class="pre">Py_VA_COPY()</span></code> uses <code class="docutils literal"><span class="pre">memcpy()</span></code>
to make a copy of a <code class="docutils literal"><span class="pre">va_list</span></code> variable. Coverity detects two issues in
this approach: &quot;Passing argument &quot;lva&quot; of type &quot;va_list&quot; and sizeof(va_list)
to function memcpy() is suspicious.&quot; CID 486405 and &quot;Uninitialized pointer
read&quot; CID 486630.</dd>
</dl>




    </article>
  </slide>  <slide class="level-2" id="modeling">
    <hgroup>
      <h2>Modeling</h2>
    </hgroup>
    <article class="">
      <p>Modeling is explained in the <em>Coverity Help Center</em> which is available in
the help menu of <a class="reference external" href="http://scan5.coverity.com:8080/">Coverity Connect</a>. <a class="reference external" href="https://hg.python.org/cpython/file/tip/Misc/coverity_model.c">coverity_model.c</a> contains a copy of
Python's modeling file for Coverity. Please keep the copy in sync with the
model file in <em>Analysis Settings</em> of <a class="reference external" href="http://scan.coverity.com/">Coverity Scan</a>.</p>




    </article>
  </slide>  <slide class="level-2" id="workflow">
    <hgroup>
      <h2>Workflow</h2>
    </hgroup>
    <article class="">
      



    </article>
  </slide>  <slide class="level-3" id="false-positive-and-intentional-issues">
    <hgroup>
      <h3>False positive and intentional issues</h3>
    </hgroup>
    <article class="">
      <p>If the problem is listed under <a class="reference internal" href="#known-limitations">Known limitations</a> then please set the
classification to either &quot;False positive&quot; or &quot;Intentional&quot;, the action to
&quot;Ignore&quot;, owner to your own account and add a comment why the issue
is considered false positive or intentional.</p>
<p>If you think it's a new false positive or intentional then please contact an
admin. The first step should be an updated to Python's <a class="reference internal" href="#modeling">Modeling</a> file.</p>




    </article>
  </slide>  <slide class="level-3" id="positive-issues">
    <hgroup>
      <h3>Positive issues</h3>
    </hgroup>
    <article class="">
      <p>You should always create an issue unless it's really a trivial case. Please
add the full url to the ticket under <em>Ext. Reference</em> and add the CID
(Coverity ID) to both the ticket and the checkin message. It makes it much
easier to understand the relation between tickets, fixes and Coverity issues.</p>




    </article>
  </slide>  <slide class="level-2" id="contact">
    <hgroup>
      <h2>Contact</h2>
    </hgroup>
    <article class="">
      <p>Please include both Brett and Christian in any mail regarding Coverity. Mails
to Coverity should go through Brett or Christian, too.</p>
<dl class="docutils">
<dt>Christian Heimes &lt;christian (at) python (dot) org&gt;</dt>
<dd>admin, maintainer of build machine, intermediary between Python and Coverity</dd>
<dt>Brett Cannon &lt;brett (at) python (dot) org&gt;</dt>
<dd>co-admin</dd>
<dt>Dakshesh Vyas &lt;<a class="reference external" href="mailto:scan-admin&#37;&#52;&#48;coverity&#46;com">scan-admin<span>&#64;</span>coverity<span>&#46;</span>com</a>&gt;</dt>
<dd>Technical Manager - Coverity Scan</dd>
</dl>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference external" href="http://scan.coverity.com/faq/">Coverity Scan FAQ</a></p>
</div>




    </article>
  </slide>


    <slide class="thank-you-slide segue nobackground">
    <article class="flexbox vleft auto-fadein">
      <h2>&lt;Thank You!&gt;</h2>
    </article>
    <p class="auto-fadein" data-config-contact>
      <!-- populated from slide_config.json -->
    </p>
  </slide>

  <slide class="backdrop"></slide>

</slides>

<!--[if IE]>
  <script src="http://ajax.googleapis.com/ajax/libs/chrome-frame/1/CFInstall.min.js"></script>
  <script>CFInstall.check({mode: 'overlay'});</script>
<![endif]-->
</body>
</html>